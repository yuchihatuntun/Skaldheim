### 绪论

#### 1-1 微型计算机的组成原理

微型计算机系统包含**硬件**和**软件**两大部分。

- **软件**是为运行、管理和维护微机而编制的各类程序的总和，分为**系统软件**和**应用软件**：
  - 系统软件通常包括操作系统、语言处理程序、诊断调试程序、设备驱动程序，以及为提高微机效率设计的各类程序。
  - 应用软件是用于特定应用领域的专用软件，又分两类：
    - 为解决某一具体应用、按用户特定需要编制的应用程序；
    - 适合多种不同领域的通用性应用软件（如文字处理软件、绘图软件、财务管理软件等）。

##### 1-1-1 微型计算机的硬件组成

![alt text](image-2.png)

1. **存储器**

内存储器又称**主存储器**，是微型计算机的存储和记忆装置，用于存放**数据和程序**。

CPU对内存的操作有两种：

- **读操作**：CPU将内存单元的内容读入CPU内部；
- **写操作**：CPU将其内部信息传送到内存单元保存。

> [!NOTE] 内存分类
> 内存分为两类：
> 
> - **RAM（Random Access Memory，随机访问存储器）**：也叫"读写存储器"，用于**临时存放程序和数据**；特点是**电源掉电时信息会丢失**，属于**易失性存储器**。
> - **ROM（Read Only Memory，只读存储器）**：工作时**只能读、不能写**；特点是**电源掉电时信息不会丢失**，属于**非易失性存储器**。

存储器与系统的交互及程序运行逻辑

- 输入/输出设备通过“输入/输出接口”与系统总线相连，**外存（辅助存储器）也属于输入/输出设备**。
- 程序和数据都以**二进制形式**存放在存储器中。程序一般按“指令在存储器中的存放顺序”执行，遇到**转移指令**则转向“目标地址”执行。
- 开机流程：首先运行**ROM中的引导程序**，由引导程序将“外存中的操作系统”装入**RAM**中运行，之后由操作系统管理微型计算机的运行。

> [!NOTE] 存储器的"分级存储"设计
> 为同时满足**存储容量大**和**存取速度快**的需求，存储器采用**分级存储方式**：
> 
> - 用**速度较高的半导体存储器**作为**内存（主存储器）**；
> - 用**容量较大、存取速度相对较低**的磁表面存储器（如硬盘）或光盘存储器作为**外存（辅助存储器）**。

<span style="font-weight:bold; color:rgb(255, 182, 193)">主存储器</span>

主存储器（简称“主存”）用于存放计算机**当前执行的程序和需要使用的数据**，存取速度快，CPU可直接对其访问。
它主要由半导体器件组成，分为 **RAM（随机存取存储器）** 和 **ROM（只读存储器）** 两类。

主存储器的核心部件包括：<span style="background:rgba(163, 218, 252, 0.55)">存储体（存放信息的实体）、地址寄存器、选址部件、数据缓冲寄存器、读写控制电路等</span>。

> [!NOTE] 存储地址
> 存储体被划分为若干**存储单元**，每个单元存放一串二进制数（如一个字节、一个字）。
> 为区分不同存储单元，会按一定顺序（如"按字节"或"按字"）对单元编号，这些编号称为**存储地址**（简称"地址"）。
> 
> 存储器共有$N$个存储单元，地址编号为$0 \sim (N-1)$；每个地址单元中存放的数据称为"该地址单元的内容"，CPU可对每个地址对应的单元内容进行**读写操作**。

> [!NOTE] 存储容量的决定因素
> 存储器包含的**存储单元总数**称为**存储容量**，它由CPU的**地址总线根数**决定（地址总线的位数直接决定"可寻址的范围大小"）。
> 
> - 举例1：8086CPU有20条地址总线，能访问的内存容量为 \( 2^{20} = 1\text{MB} \)；
> - 举例2：PentiumⅡCPU有36条地址总线，能访问的内存容量为 \( 2^{36} = 64\text{GB} \)。
> 
> 简言之：地址总线的位数越多，CPU可访问的存储容量就越大。

<span style="font-weight:bold; color:rgb(255, 182, 193)">辅助存储器（外存）</span>

- **作用**：作为主存储器的“后备/补充”，特点是**存储容量大、成本低、可脱机保存信息**；用于存放“非当前运行的程序和数据”。
- **数据交换方式**：因存取周期比主存长，**不直接与CPU交换数据**，需先与主存“成批交换数据”，再由主存与CPU通信，因此属于**主机外部设备（简称“外存”）**。
- **常见类型**：微型计算机中常见的有软盘存储器、硬盘存储器、光盘存储器、闪存等。

<span style="font-weight:bold; color:rgb(255, 182, 193)">Cache（高速缓冲存储器）技术</span>

- **背景**：主存储器的读写速度会影响系统性能；随着CPU时钟频率提升，主存速度逐渐成为“系统性能提升的瓶颈”。
- **早期方案局限**：高速双极性RAM（存取时间十几/几十个纳秒）能与CPU速度匹配，但**体积大、价格昂贵**，难以普及。
- **Cache的作用与原理**：
  Cache是位于**CPU和主存储器之间**、**规模小但速度很高**的存储器，保存主存中“一部分内容的拷贝”。
  CPU读写数据时，**优先访问Cache**；只有Cache中没有所需数据时，才去访问主存，从而解决“CPU与主存的速度匹配问题”。
- 目前多数CPU产品已将Cache**集成在CPU内部**。

<span style="font-weight:bold; color:rgb(255, 182, 193)">虚拟存储器（虚存）技术</span>

- **需求背景**：程序占用存储容量增加，多用户/多任务操作系统出现后，主存容量往往无法满足程序的存储需求。
- **组成与效果**：由“价格较高、速度较快、容量较小的主存储器”和“价格低廉、速度较慢、容量巨大的辅助存储器”组成**多层次存储结构**；在系统软件和辅助硬件的管理下，这套结构“像一个单一的、可直接访问的大容量存储器”，以“透明方式”为用户程序提供**远大于主存容量的存储空间**。

> [!tip] 虚拟存储器的工作原理
> 虚拟存储器的工作原理基于**硬件（内存管理单元MMU）与操作系统的协作**，核心是通过"虚拟地址到物理地址的映射"和"页面调度"，让程序以为自己拥有远大于实际物理内存的地址空间。具体过程如下：  
> 
> **1. 虚拟地址与物理地址的分离**
> 
> 程序编译/运行时使用的是**虚拟地址**（逻辑地址），而非直接访问物理内存的物理地址。虚拟地址空间由操作系统为每个进程"虚拟"分配，可远大于实际物理内存容量（例如32位系统虚拟地址空间可达4GB）。  
> 
> **2. 地址转换：虚拟地址→物理地址**
> 
> CPU通过**内存管理单元（MMU）**将虚拟地址转换为物理地址，依赖操作系统维护的**页表（Page Table）**实现映射：  
> 
> - 页表记录"虚拟页（Virtual Page, VP）"与"物理页框（Physical Frame）"的对应关系。  
> - 虚拟地址被拆分为"虚拟页号（VPN）"和"页内偏移量（Offset）"：  
>   - **虚拟页号**用于检索页表，找到对应的物理页号（Physical Page Number, PPN）；  
>   - **页内偏移量**直接对应物理页内的位置（因虚拟页与物理页大小相同，偏移量无需转换）。  
> 
> **3. 缺页中断与页面加载**
> 
> 若程序访问的虚拟页**未加载到物理内存中**（即页表中该虚拟页的映射为"未缓存"），MMU会触发**缺页中断（Page Fault）**，操作系统介入处理：  
> 
> - 操作系统从硬盘（辅助存储器）中找到该虚拟页对应的"磁盘页"，将其加载到物理内存的空闲页框中；  
> - 更新页表，建立该虚拟页与物理页框的新映射；  
> - 重新执行被中断的指令，此时虚拟地址可成功转换为物理地址。  
> 
> **4. 页面调度（置换）：内存不足时的动态调整**
> 
> 若物理内存已满，操作系统会通过**页面置换算法**（如LRU、FIFO）选择"不常用的物理页"，将其**写回硬盘**（页面交换，Swapping），腾出空间加载新的虚拟页。  
> 
> **5. 透明性与多进程隔离**
> 
> 虚拟存储器对用户程序"透明"——程序无需感知物理内存的实际容量，只需按虚拟地址编程；同时，**不同进程的虚拟地址可映射到同一块物理地址**（如共享库），既节省内存又实现进程隔离（通过页表权限控制，如只读、可写）。 


2. **I/O接口和外部设备**

外部设备是微型计算机的输入/输出（I/O）设备，为微机提供具体的输入/输出手段：

   - 输入设备：如键盘、鼠标、扫描仪等；
   - 输出设备：如显示器、打印机、绘图仪等；
   - 双向设备（既输入又输出）：磁盘、光盘。

> [!NOTE] I/O 接口  
> 外部设备的工作速度、驱动方式与 CPU 相差甚远，无法直接连接到系统总线。因此需要 I/O 接口电路作为“桥梁”，负责完成：
> 
> - 信号变换（匹配 CPU 与外设的信号格式）
> - 数据缓冲（暂存数据，协调速度差异）
> - 与 CPU 联络（同步读写时机）

外设接口中，用于存放数据、状态、控制信息的8位寄存器称为**端口**。为了能定位到具体端口，需要对端口进行**编址**，编址方式有两种：

   - 与内存单元**统一编址**（端口视为特殊的内存单元）；
   - 与内存**独立编址**（端口有专门的地址空间）。（`Intel 80x86/Pentium`系列采用**独立编址**方式。）
   
3. 系统总线

微型计算机硬件（微处理器、内存、I/O接口、外部设备）通过**总线**连接，总线是各部件间传送信息的“公共导线”。

> [!NOTE] 总线的两种分类方式
> 
> - **按传送信号的性质**：分为 **数据总线（DB）**、**地址总线（AB）**、**控制总线（CB）**，分别传送数据、地址、控制信号。
> - **按连接对象**：分为 **系统总线**（连接微机内部部件，如微处理器、存储器、外设接口）、**局部总线**（连接 CPU 与外围支持芯片）、**外部总线**（连接微机与外部设备/其他计算机）。

单处理器微机的**系统总线**由地址总线、数据总线、控制总线组成，各自作用如下：

1. **地址总线（AB, Address Bus）**
   - 功能：传送CPU发出的**地址信息**，确定被访问的“存储单元”或“I/O端口”。
   - 特点：**单向传输**（地址仅从CPU送出）；**位数决定寻址范围**（如16位8086微机的地址总线为20位，最大内存容量为 \( 2^{20} \) 个存储单元）。

2. **数据总线（DB, Data Bus）**
   - 功能：在CPU与存储器、I/O接口之间**传送数据**。
   - 特点：**双向传输**（CPU可通过DB从内存/输入设备“读入”数据，也可向内存/输出设备“送出”数据）；**位数（宽度）是微机重要指标**，与微处理器位数对应（如16位微机的DB宽度为16位）。

3. **控制总线（CB, Control Bus）**
   - 功能：传输**控制信号**，包含两类：
     - CPU发往存储器、I/O接口的控制信号（如“读信号”“写信号”“中断响应信号”等）；
     - 其他部件发给CPU的信号（如“时钟信号”“中断请求信号”“准备就绪信号”等）。
   - 特点：每根控制线的**传送方向固定**（由信号的“发起者”和“接收者”决定）。

##### 1-1-2 （8位）微处理器的组成

![alt text](image-3.png)

1. **运算器**

运算器的核心作用是**对数据进行加工处理**，主要完成**算术运算**（如加、减、乘、除）和**逻辑运算**。
尽管不同计算机的运算器结构有差异，但最基础的结构都包含这些逻辑部件：

- **算术逻辑单元（ALU）**：是运算器的**核心部件**，不仅承担加、减、乘、除等**基本算术运算**，还具备**移位功能**，能执行“与”“或”“非”等**逻辑运算**，以及**求补操作**。
- 此外，还包括累加器、寄存器组、多路转换器、数据总线等。

由于运算过程会涉及各类数据，因此在微处理器中，**设置通用寄存器**或者**通过堆栈指针访问内存中的堆栈区**十分必要。它们的作用是：

- 传递、存放**参与运算的数据**、**运算结果**；
- 存放**进位标志、符号标志**等表示“运算特征”的标志。

寄存器的存在有两大优势：

- 减少访问存储器的次数，**提高运算速度**；
- 方便程序员存放各类数据，**为程序设计带来便利**。

2. **控制器**

控制器是计算机**关键部件**，依据**预先存放在存储器中的程序**对计算机进行整体控制。它一般由**指令寄存器**（暂存取出的指令）、**指令译码器**（分析指令含义）和**控制电路**组成；通过解析每条指令，向计算机各部件发控制信息，使部件协调工作，实现程序功能。

> [!NOTE] 指令、指令系统与程序的概念
> 
> 计算机的工作，本质是**执行程序中一条条指令的过程**：
> 
> - **指令**：由二进制代码构成，分**操作码**（规定“执行什么操作”，如加、减）和**操作数**（指明“参与运算的数或其地址”）两部分。
> - **指令系统**：一台计算机能执行的**全部指令的集合**，反映计算机基本功能；因计算机内部结构不同，指令系统也存在差异。
> - **程序**：完成某一任务的**一组指令的集合**。微型计算机基于**冯·诺依曼“程序存储”“程序控制”原理**设计——程序预先存入存储器，计算机通过执行程序完成任务。

控制器的工作过程（冯·诺依曼原理）：

微型计算机的工作过程是**周而复始地“取指令→分析指令→执行指令”**，控制器是这一过程的核心：

- 控制器从内存**取出指令**，并指明“下一条指令在内存的位置”；
- 取出的指令送入**指令寄存器**，再经**指令译码器**分析；
- 译码后，控制器发**控制/定时信息**，协调各部件有条不紊工作，完成指令规定的操作；
- 重复“取→分析→执行”的循环，使计算机持续运行。

尽管控制器的组成会因指令格式、控制方式、总线结构及机型不同存在差异，但一般包含以下关键部件：

> [!NOTE] 程序计数器（Program Counter，PC）
>
> 又称“指令地址寄存器”，核心作用是**指示程序执行的顺序**：
>
> - 取指令阶段：指示**当前要执行的指令在存储器中的地址**；
> - 指令执行完毕后：存放**下一条要执行的指令的地址**，保证程序“按序执行”。

> [!NOTE] 指令寄存器（Instruction Register，IR）
>
> 用于**保存计算机正在执行的指令代码**（这些代码从存储器读出后送入IR）。
>
> - 指令执行期间：IR的内容保持不变；
> - 指令执行完毕后：新的指令会从存储器读入IR，为下一条指令的执行做准备。

> [!NOTE] 指令译码器（Instruction Decoder，ID）
>
> 也叫“指令分析器”，功能是**分析指令并生成操作信号**：  
> 根据指令的内容（如操作码、操作数）和各类标志（如运算状态标志），分析出本条指令需要的**各类操作信号**，并将这些信号发送到各个执行部件（如运算器、存储器等），指挥部件执行对应操作。

> [!NOTE] 时序产生器及启停线路
>
> 微型计算机是**同步时序装置**（操作步骤严格按时序进行，不同指令执行时间不同），这部分负责“控制操作的时间节奏”：
>
> - **时序产生器**：产生执行各种基本操作（取指令、运算、存结果等）所需的**一系列控制信号**，保证计算机能正确完成规定任务。
> - **启停线路**：控制时序信号是否发出。它会综合“硬件状态、程序要求、人工操作需求”，在合适时机发出“启动/停止”时序信号的指令，协调计算机工作节奏。

> [!NOTE] 状态/条件寄存器
>
> 用于**保存指令执行后的“状态信息”**：
>
> - 保存“条件码”：如运算是否溢出、结果正负、有无进位等；
> - 保存其他状态：如中断状态（是否有中断请求）、系统工作状态（运行/待机等），为后续指令执行或系统控制提供依据。

> [!NOTE] 微操作信号发生器
>
> 作用是**综合多类信号，生成“指令执行的操作序列”**：  
> 将“指令自身的操作信号（做什么操作）”“时序产生器的时序信号（何时操作）”“控制功能部件反馈的状态信号（部件当前状态）”综合起来，生成特定的**操作序列**，从而完成“取指令→分析指令→执行指令”全过程的控制，确保指令被正确、有序执行。

**控制器的功能扩展**：

控制器除了前文提到的核心部件（程序计数器、指令寄存器、指令译码器等），通常还包含**中断控制、地址形成**等功能部件，用于完成**中断处理**（响应外部设备的请求）、**指令地址生成**等操作，进一步支撑计算机的复杂运行需求。

<span style="font-weight:bold; color:rgb(255, 182, 193)">微处理器执行一条指令的步骤</span>

微处理器执行一条指令需经历以下5个阶段，体现了“取指令→分析指令→执行指令→处理外部请求”的完整流程：

1. **地址准备与PC自增**
   程序计数器（PC）将当前要执行的**指令地址**送入地址总线；同时，PC自身内容加1，为“取下一指令的字节”或“下一条指令”提前做好地址准备，保证指令按序执行。

2. **读取指令码到指令寄存器**
   通过数据总线，从存储器中取出**指令码（操作码）**，并将其送入**指令寄存器（IR）**暂存，为后续译码做准备。

3. **指令译码与控制信号生成**
   指令译码器（ID）对指令的**操作码**进行“译码”（分析指令要执行的操作）；定时与控制部件根据译码结果，生成完成该指令所需的**各种控制信号**。若需要，还会继续从存储器取出“指令的后续字节”“操作数”，或检测“处理器状态标志”“其他部件的状态信号”（比如运算是否溢出、外部设备是否就绪等）。

4. **执行指令规定的操作**
   生成必要的**内部/外部控制信号**，指挥计算机各部件（如运算器、存储器、外部设备等）协作，完成指令规定的具体操作（如算术运算、数据传输等）。

5. **检查并处理外部设备请求**
   指令操作完成后，检查是否有**外部设备的请求信号**（如“中断信号”，即外部设备需要处理器立即处理的任务）；若有，则进行相应的处理（如进入中断服务程序）。

##### 1-1-3 微型计算机的工作流程

计算机只能直接识别**二进制机器语言**，但机器语言（纯0、1代码）“难书写、难记忆”。因此，人们通常先写**汇编语言源程序**（用“助记符”“十进制/十六进制数”等更易读的形式），再将其**翻译为机器语言源程序**，供计算机执行。

以Intel 80x86系列微处理器为例，实现“3+7”需执行以下4条指令，每条指令对应“汇编代码→机器指令→具体操作”：

| 汇编语言程序   | 对应的机器指令（二进制） | 对应的操作                                                                 |
|----------------|--------------------------|--------------------------------------------------------------------------|
| `MOV AL, 3`    | `10110000` <br> `00000011` | 把立即数`3`传送到**累加寄存器AL**中（给AL赋初始值）。|
| `ADD AL, 7`    | `00000100` <br> `00000111` | 计算AL中的数（`3`）与`7`的和，结果存回**AL**中（此时AL的值为`3+7=10`）。|
| `MOV [3008], AL` | `10100010` <br> `00001000` | 把AL中的结果（`10`）传送到**地址为0008H的内存单元**中（存储计算结果）。|
| `HLT`          | `11110100`               | 停机（结束程序执行）。|

整个程序由4条指令、8个字节组成，假设存放在8位模型机存储器的`0000H~0007H`单元。执行前，先将**第1条指令的存储地址`3000H`送入程序计数器（PC）**，PC作为“指令地址指针”，指引计算机从该地址开始执行程序。

- **取指周期**：
  - PC将`3000H`送到**地址总线（AB）**（指定要读取的存储器地址）；
  - PC自身值加1，变为`3001H`（为“取下一存储器单元内容”提前准备地址）；
  - 根据AB上的地址，从`3000H`单元读出**第1条指令的操作码**，经**数据总线（DB）**传送到**指令寄存器（IR）**（IR暂存当前要执行的指令）；
  - **指令译码器（ID）**对IR中的操作码“译码”（分析指令功能），得知这条指令要“将下一单元的内容送入累加器AL”，随后操作控制部件发出执行该指令的控制信号。

- **执行周期**：
  - PC将`3001H`送到AB；
  - PC自身值加1，变为`3002H`（为取下一条指令做准备）；
  - 根据AB上的地址，从`3001H`单元读出**第1条指令的操作数（原文中为`03H`，对应“MOV AL, 3”里的`3`）**，经DB传送到**累加器AL**中；
  - 至此，第1条指令（将`3`送入AL）执行完毕。

第1条指令执行完后，进入第2条指令的“取指周期”：

- PC将`3002H`送到AB；
- PC自身值加1，变为`3003H`（为取下一单元内容做准备）；
- 根据AB上的地址，从`3002H`单元读出**第2条指令的操作码（原文中为`04H`，对应“ADD AL, 7”的操作码）**，经DB传送到IR；
- ID对IR中的操作码译码，控制信号发生器发出执行该指令的控制信号；
- 后续会进入第2条指令的“执行周期”，读取操作数`07H`，完成“AL中的3与7相加”的操作

#### 1-2 微型计算机的发展

在微型计算机里，利用超大规模集成电路技术，把计算机中负责“运算”的运算器和负责“控制”的控制器，集成到**一个芯片**上，这个芯片就是中央处理器（CPU）。它能一边指挥计算机各部分协调工作，一边对数据做算术运算（如加、减）或逻辑运算（如“与”“或”）。因为它比过去的CPU体积小很多，所以被称为“微处理器”，习惯上也直接叫它CPU。

**微处理器（CPU）的发展阶段**

随着大规模集成电路技术进步，微处理器自1971年问世后，按**字长和功能**经历了从**4位CPU**→**8位CPU**→**16位CPU**→**32位CPU**→**64位CPU**的发展阶段。

按时间线梳理关键产品及突破：

- **1971年**：Intel推出采用**4040微处理器**的**MCS-4微型计算机**，字长4位，指令执行慢（平均20μs），功能简单（无暂停、中断，灵活性差）；后续又推出**8位微处理器8080**，并以此为核心制成**MCS-8微型计算机**，字长8位，指令系统和中央处理功能更完整。
- **1973～1977年**：
  - 初期：Intel的**MCS-80微型计算机**（基于8080），字长8位，指令执行时间缩短至2μs，支持8级中断、多种寻址方式，还可搭配高级语言。
  - 后期：以**6502微处理器**为核心的**APPLEⅡ微型计算机**，拥有超一万六千个应用程序和大量外围设备，在20世纪80年代初期风靡全球。
- **1978年**：Intel推出**8086微处理器**，采用HMOS工艺、+5V供电，芯片内有四万多只晶体管，初始时钟4.77MHz（最高10MHz）；内部/外部数据总线为16位，地址总线20位，可寻址1MB存储空间。1979年又推出**8088芯片**（成本更低，外部数据信号线减为8条，兼容已有8位硬件）。
- **1981～1982年**：Intel推出8086的改进型**80186**、**80286**。其中**80286**亮点突出：
  - 指令兼容：与8086、80186“向上兼容”，支持**实地址模式**和**保护虚地址模式**两种运行方式；
  - 硬件升级：内部含13.4万只晶体管，时钟频率从6MHz提升至20MHz；内部/外部数据总线16位，地址总线24位，可寻址16MB内存；
  - 功能突破：硬件设计支持**多用户、多任务处理**，支持虚拟存储器管理与硬件保护机制；指令系统新增大量指令，能支持更高级的操作系统，性能大幅提升。

#### 1-3 数据的表示方法

详见数电笔记


